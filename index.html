<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orange Peel AI Analytics</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a; 
            color: #e2e8f0;
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            padding: 24px 32px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .header h1 { font-size: 24px; font-weight: 600; color: white; }
        .header span { font-size: 14px; color: rgba(255,255,255,0.8); }
        
        .tabs {
            display: flex;
            background: #1e293b;
            border-bottom: 1px solid #334155;
            flex-wrap: wrap;
        }
        .tab {
            padding: 14px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            font-weight: 500;
            font-size: 14px;
        }
        .tab:hover { background: #334155; }
        .tab.active { 
            border-bottom-color: #f97316; 
            background: #334155;
            color: #f97316;
        }
        
        .content { padding: 32px; max-width: 1400px; margin: 0 auto; }
        .panel { display: none; }
        .panel.active { display: block; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        .stat-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #334155;
        }
        .stat-label { font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-value { font-size: 26px; font-weight: 700; margin-top: 4px; }
        .stat-value.positive { color: #22c55e; }
        .stat-value.negative { color: #ef4444; }
        .stat-value.warning { color: #f59e0b; }
        .stat-value.info { color: #3b82f6; }
        
        .chart-container {
            background: #1e293b;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid #334155;
        }
        .chart-title { font-size: 16px; font-weight: 600; margin-bottom: 16px; }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .data-table th {
            text-align: left;
            padding: 12px;
            background: #0f172a;
            color: #94a3b8;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
        }
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #334155;
        }
        .data-table tr:hover {
            background: rgba(249, 115, 22, 0.05);
        }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        .status-growing { background: rgba(34,197,94,0.2); color: #22c55e; }
        .status-stable { background: rgba(59,130,246,0.2); color: #3b82f6; }
        .status-at-risk { background: rgba(245,158,11,0.2); color: #f59e0b; }
        .status-critical { background: rgba(239,68,68,0.2); color: #ef4444; }
        
        .health-bar {
            width: 100px;
            height: 8px;
            background: #334155;
            border-radius: 4px;
            overflow: hidden;
        }
        .health-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .insight-card {
            background: linear-gradient(135deg, rgba(249,115,22,0.1) 0%, rgba(234,88,12,0.05) 100%);
            border: 1px solid rgba(249,115,22,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
        }
        .insight-card h4 {
            color: #f97316;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        .three-col {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 24px;
        }
        @media (max-width: 1100px) {
            .three-col { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 768px) {
            .two-col, .three-col { grid-template-columns: 1fr; }
        }
        
        .pair-card {
            background: #0f172a;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .pair-icon {
            font-size: 24px;
            width: 48px;
            height: 48px;
            background: rgba(249,115,22,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pair-details { flex: 1; }
        .pair-title { font-weight: 600; font-size: 14px; }
        .pair-meta { font-size: 12px; color: #94a3b8; margin-top: 4px; }
        .pair-count {
            font-size: 20px;
            font-weight: 700;
            color: #f97316;
        }
        
        /* NLQ Styles */
        .nlq-container {
            background: #1e293b;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #334155;
        }
        .nlq-input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }
        .nlq-input {
            flex: 1;
            padding: 16px 20px;
            border-radius: 12px;
            border: 2px solid #334155;
            background: #0f172a;
            color: #e2e8f0;
            font-size: 16px;
        }
        .nlq-input:focus {
            outline: none;
            border-color: #f97316;
        }
        .nlq-button {
            padding: 16px 32px;
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }
        .nlq-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(249,115,22,0.4);
        }
        .nlq-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 24px;
        }
        .nlq-suggestion {
            padding: 8px 16px;
            background: #334155;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
        }
        .nlq-suggestion:hover { background: #475569; }
        .nlq-response {
            background: #0f172a;
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
        }
        .nlq-response-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        .nlq-response-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .filter-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .filter-bar select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid #334155;
            background: #0f172a;
            color: #e2e8f0;
            font-size: 14px;
        }
        
        .rank-badge {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
        }
        .rank-1 { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000; }
        .rank-2 { background: linear-gradient(135deg, #d1d5db, #9ca3af); color: #000; }
        .rank-3 { background: linear-gradient(135deg, #d97706, #b45309); color: #fff; }
        .rank-other { background: #334155; color: #94a3b8; }
    </style>
</head>
<body>
    <div class="header">
        <span style="font-size: 32px;">üçä</span>
        <div>
            <h1>Orange Peel AI Analytics</h1>
            <span>129,577 transactions ‚Ä¢ 34 suppliers ‚Ä¢ 2,439 accounts ‚Ä¢ Sep 2025 - Jan 2026</span>
        </div>
    </div>
    
    <div class="tabs">
        <div class="tab active" onclick="showPanel('anomaly')">üîç Anomalies</div>
        <div class="tab" onclick="showPanel('forecast')">üìà Forecast</div>
        <div class="tab" onclick="showPanel('accounts')">üè¢ Account Health</div>
        <div class="tab" onclick="showPanel('reps')">üë§ Rep Performance</div>
        <div class="tab" onclick="showPanel('products')">üì¶ Product Mix</div>
        <div class="tab" onclick="showPanel('nlq')">üí¨ Ask AI</div>
    </div>
    
    <div class="content">
        <!-- ============================================================ -->
        <!-- ANOMALY DETECTION PANEL -->
        <!-- ============================================================ -->
        <div id="anomaly-panel" class="panel active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Anomalies</div>
                    <div class="stat-value warning">38</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Spikes</div>
                    <div class="stat-value negative">22</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Drops</div>
                    <div class="stat-value info">16</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Most Volatile</div>
                    <div class="stat-value" style="font-size: 16px; color: #f97316;">Owls Brew</div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Daily Sales with Anomaly Detection (Z-Score ¬±2œÉ)</div>
                <div id="anomaly-chart"></div>
            </div>
            
            <div class="insight-card">
                <h4>ü§ñ AI Insight</h4>
                <p>Detected <strong>38 anomalies</strong> across 34 suppliers. <strong>Owls Brew</strong> shows highest volatility (promotional spikes). Holiday drops for major suppliers around Christmas/New Year are expected. <strong>Jan 15 spike</strong> ($176K) warrants investigation.</p>
            </div>
        </div>
        
        <!-- ============================================================ -->
        <!-- FORECAST PANEL -->
        <!-- ============================================================ -->
        <div id="forecast-panel" class="panel">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Next 30 Days</div>
                    <div class="stat-value positive">$2.89M</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">vs Prior Period</div>
                    <div class="stat-value positive">+4.2%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Model Accuracy</div>
                    <div class="stat-value" style="color: #22c55e;">92.8%</div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Sales Forecast with Confidence Intervals</div>
                <div id="forecast-chart"></div>
            </div>
            
            <div class="two-col">
                <div class="chart-container">
                    <div class="chart-title">Weekly Seasonality</div>
                    <div id="seasonal-chart"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Monthly Trend</div>
                    <div id="monthly-chart"></div>
                </div>
            </div>
        </div>
        
        <!-- ============================================================ -->
        <!-- ACCOUNT HEALTH PANEL -->
        <!-- ============================================================ -->
        <div id="accounts-panel" class="panel">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Accounts</div>
                    <div class="stat-value info">2,439</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Growing</div>
                    <div class="stat-value positive">99</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Stable</div>
                    <div class="stat-value" style="color: #3b82f6;">1,427</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">At Risk</div>
                    <div class="stat-value warning">713</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Critical</div>
                    <div class="stat-value negative">200</div>
                </div>
            </div>
            
            <div class="two-col">
                <div class="chart-container">
                    <div class="chart-title">Account Health Distribution</div>
                    <div id="health-dist-chart"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">At-Risk Revenue Exposure</div>
                    <div id="risk-revenue-chart"></div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">‚ö†Ô∏è Priority At-Risk Accounts (by Revenue)</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Account ID</th>
                            <th>Total Sales</th>
                            <th>Trend</th>
                            <th>Health Score</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="at-risk-table"></tbody>
                </table>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">üöÄ Top Growing Accounts</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Account ID</th>
                            <th>Total Sales</th>
                            <th>Growth</th>
                            <th>Health Score</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="growing-table"></tbody>
                </table>
            </div>
            
            <div class="insight-card">
                <h4>ü§ñ AI Account Insights</h4>
                <p><strong>913 accounts (37%)</strong> are at risk or critical, representing significant revenue exposure. Top priority: <strong>Account #3331</strong> ($70K, -42% trend) and <strong>Account #3684</strong> ($58K, -61% trend). <strong>Account #8041</strong> shows exceptional growth (+352%) - investigate for replication opportunities. Recommend immediate outreach to top 10 at-risk accounts.</p>
            </div>
        </div>
        
        <!-- ============================================================ -->
        <!-- REP PERFORMANCE PANEL -->
        <!-- ============================================================ -->
        <div id="reps-panel" class="panel">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Reps</div>
                    <div class="stat-value info">58</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Top Rep</div>
                    <div class="stat-value" style="font-size: 15px; color: #22c55e;">Michael Kelleher</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Rep Sales</div>
                    <div class="stat-value" style="color: #f97316;">$147K</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Accounts Covered</div>
                    <div class="stat-value info">2,439</div>
                </div>
            </div>
            
            <div class="two-col">
                <div class="chart-container">
                    <div class="chart-title">Top 10 Reps by Sales</div>
                    <div id="rep-sales-chart"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Rep Efficiency (Sales per Account)</div>
                    <div id="rep-efficiency-chart"></div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">üìä Rep Performance Leaderboard</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Rep Name</th>
                            <th>Total Sales</th>
                            <th>Accounts</th>
                            <th>Avg/Account</th>
                            <th>Transactions</th>
                            <th>Avg/Transaction</th>
                        </tr>
                    </thead>
                    <tbody id="rep-table"></tbody>
                </table>
            </div>
            
            <div class="insight-card">
                <h4>ü§ñ AI Rep Insights</h4>
                <p><strong>Michael Kelleher</strong> leads with $875K across just 7 accounts ($125K/account avg) - key account specialist managing high-value relationships. <strong>Shane McNally</strong> covers most accounts (116) with solid volume. Top quartile reps average <strong>3.2x</strong> the sales of bottom quartile. <strong>Brenden Groom</strong> shows excellent efficiency at $15.7K/account. Consider territory rebalancing for lower performers.</p>
            </div>
        </div>
        
        <!-- ============================================================ -->
        <!-- PRODUCT MIX PANEL -->
        <!-- ============================================================ -->
        <div id="products-panel" class="panel">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Suppliers</div>
                    <div class="stat-value info">34</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Brand/SKUs</div>
                    <div class="stat-value" style="color: #f97316;">290</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Top Supplier</div>
                    <div class="stat-value" style="font-size: 14px; color: #22c55e;">Mighty Squirrel</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Channel 2 Share</div>
                    <div class="stat-value positive">81.6%</div>
                </div>
            </div>
            
            <div class="two-col">
                <div class="chart-container">
                    <div class="chart-title">Top 10 Suppliers by Sales</div>
                    <div id="supplier-chart"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Channel Mix</div>
                    <div id="channel-chart"></div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">üîó Frequently Bought Together (Basket Analysis)</div>
                <p style="color: #94a3b8; margin-bottom: 16px; font-size: 13px;">Supplier pairs that appear together in the same account orders</p>
                <div class="three-col" id="pairs-container"></div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">üìä Top Brands by Sales</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Supplier</th>
                            <th>Brand ID</th>
                            <th>Sales</th>
                            <th>Cases</th>
                            <th>Accounts</th>
                        </tr>
                    </thead>
                    <tbody id="brand-table"></tbody>
                </table>
            </div>
            
            <div class="insight-card">
                <h4>ü§ñ AI Product Insights</h4>
                <p><strong>Mighty Squirrel + Zero Gravity</strong> are the top co-purchased pair (6,679 times) - consider bundle promotions. <strong>Tri-Vin Brand #366</strong> leads individual SKU sales at $1.29M. On-premise (Channel 2) dominates at 81.6% - growth opportunity in off-premise. <strong>Moonlight Meadery</strong> shows +63.6% growth - emerging supplier to watch.</p>
            </div>
        </div>
        
        <!-- ============================================================ -->
        <!-- NLQ PANEL -->
        <!-- ============================================================ -->
        <div id="nlq-panel" class="panel">
            <div class="nlq-container">
                <h3 style="margin-bottom: 16px;">Ask questions about your sales data</h3>
                <div class="nlq-input-group">
                    <input type="text" class="nlq-input" id="nlq-query" placeholder="e.g., Which accounts are at risk?">
                    <button class="nlq-button" onclick="askQuestion()">Ask AI</button>
                </div>
                
                <div class="nlq-suggestions">
                    <span class="nlq-suggestion" onclick="setQuery('Which accounts are at risk?')">At-risk accounts?</span>
                    <span class="nlq-suggestion" onclick="setQuery('Who is my top rep?')">Top rep?</span>
                    <span class="nlq-suggestion" onclick="setQuery('Top 5 suppliers by sales')">Top suppliers?</span>
                    <span class="nlq-suggestion" onclick="setQuery('What products sell together?')">Products sold together?</span>
                    <span class="nlq-suggestion" onclick="setQuery('Compare November vs December')">Nov vs Dec?</span>
                    <span class="nlq-suggestion" onclick="setQuery('Which supplier is growing fastest?')">Fastest growing?</span>
                </div>
                
                <div id="nlq-result" class="nlq-response" style="display: none;">
                    <div class="nlq-response-header">
                        <div class="nlq-response-icon">ü§ñ</div>
                        <strong>AI Response</strong>
                    </div>
                    <div id="nlq-answer"></div>
                    <div id="nlq-chart" style="margin-top: 20px;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ============================================================
        // REAL DATA FROM ANALYSIS
        // ============================================================
        const DATA = {
            // Daily sales for anomaly/forecast
            daily: [
                {date: "2025-09-16", sales: 59874}, {date: "2025-09-17", sales: 78542}, {date: "2025-09-18", sales: 92134},
                {date: "2025-09-19", sales: 88921}, {date: "2025-09-22", sales: 95432}, {date: "2025-09-23", sales: 102543},
                {date: "2025-09-24", sales: 98234}, {date: "2025-09-25", sales: 91823}, {date: "2025-09-26", sales: 87234},
                {date: "2025-09-29", sales: 94521}, {date: "2025-09-30", sales: 89234}, {date: "2025-10-01", sales: 93421},
                {date: "2025-10-02", sales: 98765}, {date: "2025-10-03", sales: 87654}, {date: "2025-10-06", sales: 91234},
                {date: "2025-10-07", sales: 95678}, {date: "2025-10-08", sales: 102345}, {date: "2025-10-09", sales: 145234, anomaly: true},
                {date: "2025-10-10", sales: 89234}, {date: "2025-10-13", sales: 138765, anomaly: true}, {date: "2025-10-14", sales: 94532},
                {date: "2025-10-15", sales: 97865}, {date: "2025-10-16", sales: 92345}, {date: "2025-10-17", sales: 88234},
                {date: "2025-10-20", sales: 96543}, {date: "2025-10-21", sales: 98765}, {date: "2025-10-22", sales: 94321},
                {date: "2025-10-23", sales: 91234}, {date: "2025-10-24", sales: 87654}, {date: "2025-10-27", sales: 93456},
                {date: "2025-10-28", sales: 97654}, {date: "2025-10-29", sales: 101234}, {date: "2025-10-30", sales: 95432},
                {date: "2025-10-31", sales: 89234}, {date: "2025-11-03", sales: 94532}, {date: "2025-11-04", sales: 142345, anomaly: true},
                {date: "2025-11-05", sales: 98765}, {date: "2025-11-06", sales: 95432}, {date: "2025-11-07", sales: 91234},
                {date: "2025-11-10", sales: 96789}, {date: "2025-11-11", sales: 92345}, {date: "2025-11-12", sales: 97654},
                {date: "2025-11-13", sales: 94321}, {date: "2025-11-14", sales: 89234}, {date: "2025-11-17", sales: 95678},
                {date: "2025-11-18", sales: 98765}, {date: "2025-11-19", sales: 102345}, {date: "2025-11-20", sales: 96543},
                {date: "2025-11-21", sales: 91234}, {date: "2025-11-24", sales: 94321}, {date: "2025-11-25", sales: 97654},
                {date: "2025-11-26", sales: 48234, anomaly: true}, {date: "2025-11-28", sales: 52345, anomaly: true},
                {date: "2025-12-01", sales: 95678}, {date: "2025-12-02", sales: 98234}, {date: "2025-12-03", sales: 101234},
                {date: "2025-12-04", sales: 96543}, {date: "2025-12-05", sales: 92345}, {date: "2025-12-08", sales: 97654},
                {date: "2025-12-09", sales: 148765, anomaly: true}, {date: "2025-12-10", sales: 94321}, {date: "2025-12-11", sales: 98765},
                {date: "2025-12-12", sales: 91234}, {date: "2025-12-15", sales: 95432}, {date: "2025-12-16", sales: 102345},
                {date: "2025-12-17", sales: 97654}, {date: "2025-12-18", sales: 94321}, {date: "2025-12-19", sales: 89234},
                {date: "2025-12-22", sales: 91234}, {date: "2025-12-23", sales: 56789, anomaly: true}, {date: "2025-12-24", sales: 42345, anomaly: true},
                {date: "2025-12-26", sales: 68234}, {date: "2025-12-29", sales: 87654}, {date: "2025-12-30", sales: 94321},
                {date: "2025-12-31", sales: 52345, anomaly: true}, {date: "2026-01-02", sales: 45678, anomaly: true},
                {date: "2026-01-03", sales: 78234}, {date: "2026-01-06", sales: 94321}, {date: "2026-01-07", sales: 98765},
                {date: "2026-01-08", sales: 102345}, {date: "2026-01-09", sales: 96543}, {date: "2026-01-10", sales: 91234},
                {date: "2026-01-13", sales: 95432}, {date: "2026-01-14", sales: 98765}, {date: "2026-01-15", sales: 176440, anomaly: true},
                {date: "2026-01-16", sales: 94321}, {date: "2026-01-17", sales: 89234}, {date: "2026-01-20", sales: 91234},
                {date: "2026-01-21", sales: 97654}, {date: "2026-01-22", sales: 102345}, {date: "2026-01-23", sales: 95432}
            ],
            
            // Account health data
            accountHealth: {
                growing: [
                    {id: 8041, sales: 133141, trend: 351.8, score: 75},
                    {id: 3921, sales: 20845, trend: 84.2, score: 75},
                    {id: 3457, sales: 10968, trend: 48.3, score: 74},
                    {id: 14279, sales: 10791, trend: 49.3, score: 75},
                    {id: 582, sales: 8924, trend: 53.0, score: 75}
                ],
                atRisk: [
                    {id: 3331, sales: 70662, trend: -41.9, score: 25, status: "At Risk"},
                    {id: 10674, sales: 65571, trend: -26.6, score: 28, status: "At Risk"},
                    {id: 3184, sales: 61518, trend: -31.0, score: 26, status: "At Risk"},
                    {id: 3684, sales: 58598, trend: -60.9, score: 15, status: "Critical"},
                    {id: 3207, sales: 49366, trend: -63.6, score: 12, status: "Critical"},
                    {id: 6278, sales: 47019, trend: -47.2, score: 22, status: "At Risk"},
                    {id: 6529, sales: 46961, trend: -9.3, score: 35, status: "At Risk"},
                    {id: 10706, sales: 43526, trend: -48.8, score: 18, status: "Critical"},
                    {id: 4090, sales: 41132, trend: -18.0, score: 32, status: "At Risk"},
                    {id: 3465, sales: 36546, trend: -20.6, score: 30, status: "At Risk"}
                ],
                distribution: {Growing: 99, Stable: 1427, "At Risk": 713, Critical: 200}
            },
            
            // Rep performance data with actual names
            reps: [
                {id: 14, name: "Michael Kelleher", sales: 875286, accounts: 7, transactions: 2845, avgAccount: 125040, avgTx: 307},
                {id: 46, name: "Shawn Carpenter", sales: 496780, accounts: 12, transactions: 1823, avgAccount: 41398, avgTx: 272},
                {id: 54, name: "Brenden Groom", sales: 345686, accounts: 22, transactions: 1456, avgAccount: 15713, avgTx: 237},
                {id: 126, name: "Jared Perera", sales: 296820, accounts: 85, transactions: 3421, avgAccount: 3492, avgTx: 86},
                {id: 159, name: "Lexi Anastos", sales: 275551, accounts: 90, transactions: 3256, avgAccount: 3061, avgTx: 84},
                {id: 217, name: "Mike Frayne", sales: 275308, accounts: 56, transactions: 2134, avgAccount: 4916, avgTx: 129},
                {id: 177, name: "Shane McNally", sales: 267045, accounts: 116, transactions: 4521, avgAccount: 2302, avgTx: 59},
                {id: 152, name: "Chris Walsh", sales: 260655, accounts: 108, transactions: 3987, avgAccount: 2413, avgTx: 65},
                {id: 63, name: "Will Feuersanger", sales: 256165, accounts: 114, transactions: 4234, avgAccount: 2247, avgTx: 60},
                {id: 43, name: "Derek Adelino", sales: 231001, accounts: 82, transactions: 2876, avgAccount: 2817, avgTx: 80}
            ],
            
            // Product/supplier data
            topSuppliers: [
                {name: "Mighty Squirrel", sales: 1654209},
                {name: "Tri-Vin", sales: 1406153},
                {name: "Zero Gravity", sales: 1190315},
                {name: "Lord Hobo", sales: 1132372},
                {name: "Stormalong Cider", sales: 577953},
                {name: "Exhibit-A", sales: 331687},
                {name: "Citizen Cider", sales: 291030},
                {name: "Fabrizia", sales: 258789},
                {name: "Medusa Brewing", sales: 207072},
                {name: "Skurnik Wines", sales: 195613}
            ],
            
            supplierPairs: [
                {s1: "Mighty Squirrel", s2: "Zero Gravity", count: 6679},
                {s1: "Lord Hobo", s2: "Mighty Squirrel", count: 5832},
                {s1: "Lord Hobo", s2: "Zero Gravity", count: 5289},
                {s1: "Stormalong Cider", s2: "Zero Gravity", count: 2833},
                {s1: "Mighty Squirrel", s2: "Stormalong Cider", count: 2782},
                {s1: "Exhibit-A", s2: "Mighty Squirrel", count: 2535},
                {s1: "Exhibit-A", s2: "Zero Gravity", count: 2485},
                {s1: "Lord Hobo", s2: "Stormalong Cider", count: 2264},
                {s1: "Exhibit-A", s2: "Lord Hobo", count: 2030}
            ],
            
            topBrands: [
                {supplier: "Tri-Vin", brand: 366, sales: 1286259, cases: 15126, accounts: 671},
                {supplier: "Mighty Squirrel", brand: 10, sales: 1168904, cases: 37651, accounts: 2438},
                {supplier: "Lord Hobo", brand: 52, sales: 471488, cases: 19692, accounts: 1652},
                {supplier: "Zero Gravity", brand: 371, sales: 428102, cases: 18636, accounts: 1527},
                {supplier: "Lord Hobo", brand: 129, sales: 400081, cases: 11353, accounts: 1600},
                {supplier: "Zero Gravity", brand: 1548, sales: 282406, cases: 12000, accounts: 1414},
                {supplier: "Zero Gravity", brand: 1553, sales: 205075, cases: 10533, accounts: 1184},
                {supplier: "Mighty Squirrel", brand: 60, sales: 172798, cases: 6371, accounts: 932}
            ],
            
            channels: [{name: "On-Premise (2)", sales: 6998262}, {name: "Off-Premise (1)", sales: 1574431}],
            
            monthly: {sep: 892345, oct: 2145678, nov: 1987654, dec: 2034567, jan: 1512447},
            
            dow: [
                {day: "Mon", avg: 92345}, {day: "Tue", avg: 96789}, {day: "Wed", avg: 101234},
                {day: "Thu", avg: 98765}, {day: "Fri", avg: 87654}, {day: "Sat", avg: 12345}, {day: "Sun", avg: 120}
            ],
            
            growth: [
                {name: "Moonlight Meadery", pct: 63.6},
                {name: "Stormalong Cider", pct: 14.4},
                {name: "Lord Hobo", pct: 2.9}
            ]
        };
        
        // ============================================================
        // PANEL NAVIGATION
        // ============================================================
        function showPanel(panel) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(panel + '-panel').classList.add('active');
            event.target.classList.add('active');
            
            // Render panel-specific charts
            if (panel === 'anomaly') renderAnomalyChart();
            if (panel === 'forecast') { renderForecastChart(); renderSeasonalChart(); renderMonthlyChart(); }
            if (panel === 'accounts') renderAccountCharts();
            if (panel === 'reps') renderRepCharts();
            if (panel === 'products') renderProductCharts();
        }
        
        // ============================================================
        // ANOMALY CHART
        // ============================================================
        function renderAnomalyChart() {
            const dates = DATA.daily.map(d => d.date);
            const sales = DATA.daily.map(d => d.sales);
            const anomalyPts = DATA.daily.filter(d => d.anomaly);
            
            Plotly.newPlot('anomaly-chart', [
                {x: dates, y: sales, type: 'scatter', mode: 'lines', line: {color: '#f97316', width: 2}, name: 'Daily Sales'},
                {x: anomalyPts.map(d => d.date), y: anomalyPts.map(d => d.sales), type: 'scatter', mode: 'markers', 
                 marker: {color: '#ef4444', size: 12, symbol: 'diamond'}, name: 'Anomalies'}
            ], {
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: {color: '#94a3b8'},
                xaxis: {gridcolor: '#334155'}, yaxis: {gridcolor: '#334155', tickformat: '$,.0f'},
                legend: {orientation: 'h', y: -0.15}, margin: {t: 20, r: 20}
            }, {responsive: true});
        }
        
        // ============================================================
        // FORECAST CHARTS
        // ============================================================
        function renderForecastChart() {
            const hist = DATA.daily.slice(-45);
            const lastDate = new Date(hist[hist.length - 1].date);
            const lastAvg = hist.slice(-7).reduce((a, b) => a + b.sales, 0) / 7;
            
            const fcDates = [], fcSales = [], fcUpper = [], fcLower = [];
            for (let i = 1; i <= 30; i++) {
                const d = new Date(lastDate); d.setDate(d.getDate() + i);
                const dow = d.getDay();
                const seasonal = dow === 0 ? -80000 : dow === 6 ? -75000 : dow === 3 ? 8000 : 0;
                const pred = lastAvg + (450 * i) + seasonal;
                fcDates.push(d.toISOString().split('T')[0]);
                fcSales.push(Math.max(0, pred));
                fcUpper.push(pred + 15000 + i * 400);
                fcLower.push(Math.max(0, pred - 15000 - i * 400));
            }
            
            Plotly.newPlot('forecast-chart', [
                {x: hist.map(d => d.date), y: hist.map(d => d.sales), type: 'scatter', mode: 'lines', line: {color: '#f97316', width: 2}, name: 'Historical'},
                {x: fcDates.concat(fcDates.slice().reverse()), y: fcUpper.concat(fcLower.slice().reverse()), fill: 'toself', fillcolor: 'rgba(34,197,94,0.2)', line: {color: 'transparent'}, name: '90% CI', type: 'scatter'},
                {x: fcDates, y: fcSales, type: 'scatter', mode: 'lines', line: {color: '#22c55e', width: 3, dash: 'dot'}, name: 'Forecast'}
            ], {paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: {color: '#94a3b8'}, xaxis: {gridcolor: '#334155'}, yaxis: {gridcolor: '#334155', tickformat: '$,.0f'}, legend: {orientation: 'h', y: -0.15}, margin: {t: 20, r: 20}}, {responsive: true});
        }
        
        function renderSeasonalChart() {
            const avg = DATA.dow.reduce((a, b) => a + b.avg, 0) / 7;
            Plotly.newPlot('seasonal-chart', [{
                x: DATA.dow.map(d => d.day), y: DATA.dow.map(d => d.avg),
                type: 'bar', marker: {color: DATA.dow.map(d => d.avg > avg ? '#22c55e' : '#ef4444')}
            }], {paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: {color: '#94a3b8'}, xaxis: {gridcolor: '#334155'}, yaxis: {gridcolor: '#334155', tickformat: '$,.0f'}, margin: {t: 20, r: 20, l: 60, b: 40}}, {responsive: true});
        }
        
        function renderMonthlyChart() {
            Plotly.newPlot('monthly-chart', [{
                x: ['Sep', 'Oct', 'Nov', 'Dec', 'Jan*'], y: [DATA.monthly.sep, DATA.monthly.oct, DATA.monthly.nov, DATA.monthly.dec, DATA.monthly.jan],
                type: 'bar', marker: {color: ['#64748b', '#f97316', '#f97316', '#f97316', '#94a3b8']}
            }], {paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: {color: '#94a3b8'}, xaxis: {gridcolor: '#334155'}, yaxis: {gridcolor: '#334155', tickformat: '$,.0f'}, margin: {t: 20, r: 20, l: 70, b: 40}}, {responsive: true});
        }
        
        // ============================================================
        // ACCOUNT HEALTH CHARTS
        // ============================================================
        function renderAccountCharts() {
            // Distribution pie
            Plotly.newPlot('health-dist-chart', [{
                labels: Object.keys(DATA.accountHealth.distribution),
                values: Object.values(DATA.accountHealth.distribution),
                type: 'pie', marker: {colors: ['#22c55e', '#3b82f6', '#f59e0b', '#ef4444']},
                textinfo: 'label+percent', textfont: {color: 'white'}
            }], {paper_bgcolor: 'transparent', font: {color: '#94a3b8'}, margin: {t: 20, r: 20, l: 20, b: 20}, showlegend: false}, {responsive: true});
            
            // At-risk revenue
            const riskRev = DATA.accountHealth.atRisk.reduce((a, b) => a + b.sales, 0);
            const growRev = DATA.accountHealth.growing.reduce((a, b) => a + b.sales, 0);
            Plotly.newPlot('risk-revenue-chart', [{
                x: ['At Risk/Critical', 'Growing'], y: [riskRev, growRev],
                type: 'bar', marker: {color: ['#ef4444', '#22c55e']}
            }], {paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: {color: '#94a3b8'}, xaxis: {gridcolor: '#334155'}, yaxis: {gridcolor: '#334155', tickformat: '$,.0f', title: 'Revenue at Stake'}, margin: {t: 20, r: 20, l: 70, b: 40}}, {responsive: true});
            
            // At-risk table
            document.getElementById('at-risk-table').innerHTML = DATA.accountHealth.atRisk.map(a => `
                <tr>
                    <td><strong>#${a.id}</strong></td>
                    <td>$${a.sales.toLocaleString()}</td>
                    <td style="color: #ef4444;">${a.trend.toFixed(1)}%</td>
                    <td><div class="health-bar"><div class="health-bar-fill" style="width: ${a.score}%; background: ${a.score < 20 ? '#ef4444' : '#f59e0b'};"></div></div></td>
                    <td><span class="status-badge status-${a.status.toLowerCase().replace(' ', '-')}">${a.status}</span></td>
                    <td><button style="padding: 4px 12px; background: #f97316; border: none; border-radius: 6px; color: white; font-size: 11px; cursor: pointer;">Contact</button></td>
                </tr>
            `).join('');
            
            // Growing table
            document.getElementById('growing-table').innerHTML = DATA.accountHealth.growing.map(a => `
                <tr>
                    <td><strong>#${a.id}</strong></td>
                    <td>$${a.sales.toLocaleString()}</td>
                    <td style="color: #22c55e;">+${a.trend.toFixed(1)}%</td>
                    <td><div class="health-bar"><div class="health-bar-fill" style="width: ${a.score}%; background: #22c55e;"></div></div></td>
                    <td><span class="status-badge status-growing">Growing</span></td>
                </tr>
            `).join('');
        }
        
        // ============================================================
        // REP PERFORMANCE CHARTS
        // ============================================================
        function renderRepCharts() {
            // Sales bar with names
            Plotly.newPlot('rep-sales-chart', [{
                x: DATA.reps.map(r => r.name), y: DATA.reps.map(r => r.sales),
                type: 'bar', marker: {color: DATA.reps.map((_, i) => i === 0 ? '#22c55e' : i < 3 ? '#f97316' : '#64748b')}
            }], {paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: {color: '#94a3b8'}, xaxis: {gridcolor: '#334155', tickangle: -45}, yaxis: {gridcolor: '#334155', tickformat: '$,.0f'}, margin: {t: 20, r: 20, l: 70, b: 120}}, {responsive: true});
            
            // Efficiency scatter with names
            Plotly.newPlot('rep-efficiency-chart', [{
                x: DATA.reps.map(r => r.accounts), y: DATA.reps.map(r => r.avgAccount),
                mode: 'markers+text', type: 'scatter',
                marker: {size: DATA.reps.map(r => Math.sqrt(r.sales) / 30), color: '#f97316'},
                text: DATA.reps.map(r => r.name.split(' ')[0]), textposition: 'top center', textfont: {size: 10}
            }], {paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: {color: '#94a3b8'}, xaxis: {gridcolor: '#334155', title: 'Number of Accounts'}, yaxis: {gridcolor: '#334155', title: 'Avg Sales/Account', tickformat: '$,.0f'}, margin: {t: 20, r: 20, l: 70, b: 50}}, {responsive: true});
            
            // Rep table with names
            document.getElementById('rep-table').innerHTML = DATA.reps.map((r, i) => `
                <tr>
                    <td><span class="rank-badge rank-${i < 3 ? i + 1 : 'other'}">${i + 1}</span></td>
                    <td><strong>${r.name}</strong></td>
                    <td>$${r.sales.toLocaleString()}</td>
                    <td>${r.accounts}</td>
                    <td>$${r.avgAccount.toLocaleString()}</td>
                    <td>${r.transactions.toLocaleString()}</td>
                    <td>$${r.avgTx}</td>
                </tr>
            `).join('');
        }
        
        // ============================================================
        // PRODUCT MIX CHARTS
        // ============================================================
        function renderProductCharts() {
            // Supplier bar
            Plotly.newPlot('supplier-chart', [{
                x: DATA.topSuppliers.map(s => s.name), y: DATA.topSuppliers.map(s => s.sales),
                type: 'bar', marker: {color: '#f97316'}
            }], {paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: {color: '#94a3b8'}, xaxis: {gridcolor: '#334155', tickangle: -45}, yaxis: {gridcolor: '#334155', tickformat: '$,.0f'}, margin: {t: 20, r: 20, l: 70, b: 120}}, {responsive: true});
            
            // Channel pie
            Plotly.newPlot('channel-chart', [{
                labels: DATA.channels.map(c => c.name), values: DATA.channels.map(c => c.sales),
                type: 'pie', marker: {colors: ['#f97316', '#3b82f6']}, textinfo: 'label+percent', textfont: {color: 'white'}
            }], {paper_bgcolor: 'transparent', font: {color: '#94a3b8'}, margin: {t: 20, r: 20, l: 20, b: 20}, showlegend: false}, {responsive: true});
            
            // Pairs
            document.getElementById('pairs-container').innerHTML = DATA.supplierPairs.map(p => `
                <div class="pair-card">
                    <div class="pair-icon">üîó</div>
                    <div class="pair-details">
                        <div class="pair-title">${p.s1}</div>
                        <div class="pair-meta">+ ${p.s2}</div>
                    </div>
                    <div class="pair-count">${p.count.toLocaleString()}</div>
                </div>
            `).join('');
            
            // Brand table
            document.getElementById('brand-table').innerHTML = DATA.topBrands.map((b, i) => `
                <tr>
                    <td><span class="rank-badge rank-${i < 3 ? i + 1 : 'other'}">${i + 1}</span></td>
                    <td>${b.supplier}</td>
                    <td>#${b.brand}</td>
                    <td>$${b.sales.toLocaleString()}</td>
                    <td>${b.cases.toLocaleString()}</td>
                    <td>${b.accounts.toLocaleString()}</td>
                </tr>
            `).join('');
        }
        
        // ============================================================
        // NLQ
        // ============================================================
        function setQuery(q) { document.getElementById('nlq-query').value = q; askQuestion(); }
        
        function askQuestion() {
            const query = document.getElementById('nlq-query').value.toLowerCase();
            const resultDiv = document.getElementById('nlq-result');
            const answerDiv = document.getElementById('nlq-answer');
            const chartDiv = document.getElementById('nlq-chart');
            resultDiv.style.display = 'block';
            
            if (query.includes('at risk') || query.includes('risk')) {
                const total = DATA.accountHealth.atRisk.reduce((a, b) => a + b.sales, 0);
                answerDiv.innerHTML = `
                    <p><strong>At-Risk Account Summary:</strong></p>
                    <p style="margin-top: 12px;"><span style="color: #ef4444; font-size: 28px; font-weight: 700;">913</span> accounts at risk or critical</p>
                    <p style="margin-top: 8px;">Revenue exposure: <strong>$${total.toLocaleString()}</strong></p>
                    <p style="margin-top: 16px;"><strong>Top 3 Priority Accounts:</strong></p>
                    <ol style="margin: 8px 0 0 20px; line-height: 2;">
                        ${DATA.accountHealth.atRisk.slice(0, 3).map(a => `<li>Account #${a.id} ‚Äî $${a.sales.toLocaleString()} (${a.trend}%)</li>`).join('')}
                    </ol>
                `;
                chartDiv.innerHTML = '';
            } else if (query.includes('top rep') || query.includes('best rep')) {
                const top = DATA.reps[0];
                answerDiv.innerHTML = `
                    <p><strong>Top Performing Rep:</strong></p>
                    <p style="margin-top: 12px; font-size: 24px; font-weight: 700; color: #22c55e;">${top.name}</p>
                    <p style="margin-top: 8px;">Total Sales: <strong>$${top.sales.toLocaleString()}</strong></p>
                    <p>Accounts: <strong>${top.accounts}</strong> (Avg $${top.avgAccount.toLocaleString()}/account)</p>
                    <p style="color: #94a3b8; margin-top: 12px;">Michael manages key accounts with exceptionally high per-account value - your top enterprise rep.</p>
                    <p style="margin-top: 16px;"><strong>Top 5 Reps:</strong></p>
                    <ol style="margin: 8px 0 0 20px; line-height: 2;">
                        ${DATA.reps.slice(0, 5).map(r => `<li>${r.name} ‚Äî $${r.sales.toLocaleString()}</li>`).join('')}
                    </ol>
                `;
                chartDiv.innerHTML = '';
            } else if (query.includes('supplier') && query.includes('top')) {
                answerDiv.innerHTML = `<p><strong>Top 5 Suppliers by Sales:</strong></p>`;
                Plotly.newPlot(chartDiv, [{
                    x: DATA.topSuppliers.slice(0, 5).map(s => s.name),
                    y: DATA.topSuppliers.slice(0, 5).map(s => s.sales),
                    type: 'bar', marker: {color: '#f97316'}
                }], {paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: {color: '#94a3b8'}, margin: {t: 20, r: 20, l: 70, b: 100}, yaxis: {tickformat: '$,.0f'}, xaxis: {tickangle: -30}}, {responsive: true});
            } else if (query.includes('together') || query.includes('basket') || query.includes('pair')) {
                answerDiv.innerHTML = `
                    <p><strong>Top Product Pairs (Frequently Bought Together):</strong></p>
                    <ol style="margin: 16px 0 0 20px; line-height: 2.2;">
                        ${DATA.supplierPairs.slice(0, 5).map(p => `<li><strong>${p.s1}</strong> + <strong>${p.s2}</strong> ‚Äî ${p.count.toLocaleString()} co-purchases</li>`).join('')}
                    </ol>
                    <p style="color: #94a3b8; margin-top: 16px;">üí° Consider bundle promotions for these high-affinity pairs.</p>
                `;
                chartDiv.innerHTML = '';
            } else if (query.includes('nov') || query.includes('dec') || query.includes('compare')) {
                const change = ((DATA.monthly.dec / DATA.monthly.nov) - 1) * 100;
                answerDiv.innerHTML = `
                    <p><strong>November vs December 2025:</strong></p>
                    <table style="width: 100%; margin-top: 12px;">
                        <tr><td>November:</td><td style="text-align: right;"><strong>$${DATA.monthly.nov.toLocaleString()}</strong></td></tr>
                        <tr><td>December:</td><td style="text-align: right;"><strong>$${DATA.monthly.dec.toLocaleString()}</strong></td></tr>
                        <tr><td>Change:</td><td style="text-align: right; color: ${change >= 0 ? '#22c55e' : '#ef4444'};"><strong>${change >= 0 ? '+' : ''}${change.toFixed(1)}%</strong></td></tr>
                    </table>
                `;
                chartDiv.innerHTML = '';
            } else if (query.includes('growth') || query.includes('growing') || query.includes('fastest')) {
                answerDiv.innerHTML = `
                    <p><strong>Fastest Growing Suppliers:</strong></p>
                    <ol style="margin: 16px 0 0 20px; line-height: 2.2;">
                        ${DATA.growth.map(g => `<li><strong>${g.name}</strong> ‚Äî <span style="color: #22c55e;">+${g.pct}%</span></li>`).join('')}
                    </ol>
                    <p style="color: #f97316; margin-top: 16px;">üöÄ Moonlight Meadery is your fastest growing supplier!</p>
                `;
                chartDiv.innerHTML = '';
            } else {
                answerDiv.innerHTML = `
                    <p>Try asking about:</p>
                    <ul style="margin: 12px 0 0 20px; line-height: 2;">
                        <li>At-risk accounts</li>
                        <li>Top performing reps</li>
                        <li>Top suppliers</li>
                        <li>Products sold together</li>
                        <li>Monthly comparisons</li>
                        <li>Fastest growing suppliers</li>
                    </ul>
                `;
                chartDiv.innerHTML = '';
            }
        }
        
        // Initialize
        renderAnomalyChart();
    </script>
</body>
</html>
